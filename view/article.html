<div id="articleDiv"></div>
<div class="row">
    <form onsubmit="addComment(); return false;" class="my-4">
        <div class="mb-3">
            <textarea id="commentTextArea" name="comment" class="form-control" placeholder="Комментарий"></textarea>
        </div>
        <input type="submit" class="btn btn-primary" value="Добавить комментарий">
    </form>
</div>
<div id="commentDiv"></div>

<script>
    let articleId =location.pathname.split('/')[2];
    let container = document.getElementById('container');
    let commentTextArea = document.getElementById('commentTextArea');
    let articleDiv = document.getElementById('articleDiv');
    let commentDiv = document.getElementById('commentDiv');
    let formData = new FormData();
    formData.append("article_id", articleId);
    fetch('/article',{
        method: "POST",
        body: formData
    }).then(response=>response.json())
        .then(result=>{
            console.log(result);
            articleDiv.innerHTML = `
            <h1 class="text-center">${result.title}</h1>
            <div class="my-3">${result.content}</div>
            <div class="row">
                <div class="col-6 text-start">
                    Автор: ${result.email}
                </div>
                <div class="col-6 text-end">
                    <a href="/deleteArticle/?id=${articleId}">[удалить]</a>
                </div>
            </div>
            `;
        })


    getComment()
    function getComment(){
         fetch('/getCommentByArticalId', {
            method: "POST",
            body: formData
        }).then(response=>response.json())
            .then(result=>{
            result=result.reverse();
                for (let index = 0; index < result.length; index++) {
                   renderComment(result[index].name+" "+result[index].lastname, result[index].comment)
                }
                console.log(result);
            })
    }

    function renderComment(user, comment){
        let card = document.createElement("div");
        let cardHeader = document.createElement("div");
        let cardBody =document.createElement("div");
        let cardText =document.createElement("p");

        card.classList.add("card", "mb-3");
        cardHeader.classList.add("card-header");
        cardHeader.innerText=user;
        cardBody.classList.add("card-body");
        cardText.classList.add("card-text");
        cardText.innerText=comment;
        card.append(cardHeader);
        card.append(cardBody);
        cardBody.append(cardText);
        commentDiv.prepend(card);

    }
   

    function addComment(){
        let formData = new FormData();
        formData.append('article_id', articleId);
        formData.append(commentTextArea.name, commentTextArea.value);
        fetch('/addComment', {
            method: "POST",
            body: formData
        }).then(response=>response.json())
            .then(result=>{
                console.log(result);
                if(result.result == 'success') {renderComment("Мой комментарий", commentTextArea.value);
                commentTextArea.value="";    
                }
            })
    }
</script>